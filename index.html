import { useEffect, useState } from "react";
import liff from "@line/liff";
import { Button, Card, CardContent } from "@/components/ui";

export default function SignInPage() {
  const [userId, setUserId] = useState("");
  const [displayName, setDisplayName] = useState("");
  const [isSignedIn, setIsSignedIn] = useState(false);

  useEffect(() => {
   liff.init({ liffUrl: "https://liff.line.me/2006949127-qlKbVbKb" }).then(() => {
      if (liff.isLoggedIn()) {
        liff.getProfile().then((profile) => {
          setUserId(profile.userId);
          setDisplayName(profile.displayName);
        });
      } else {
        liff.login();
      }
    });
  }, []);

  const handleSignIn = async () => {
    if (!userId) return;
    try {
      const response = await fetch("YOUR_GAS_WEB_APP_URL", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, displayName }),
      });
      const result = await response.json();
      alert(result.message);
      setIsSignedIn(true);
    } catch (error) {
      console.error("Error signing in:", error);
    }
  };

  return (
    <div className="flex flex-col items-center justify-center h-screen bg-black text-white space-y-6">
      <h1 className="text-4xl font-bold animate-pulse">ğŸŒŒ å°å®‡å®™ç°½åˆ°ç³»çµ± ğŸŒ </h1>
      <Card className="p-6 text-center bg-gray-800 border border-gray-500 shadow-lg rounded-2xl">
        <CardContent>
          <p className="text-lg">{displayName ? `æ­¡è¿, ${displayName} ğŸŒŸ` : "è¼‰å…¥ä¸­..."}</p>
          <Button className="mt-6 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-md transition-all duration-300 ease-in-out transform hover:scale-110" onClick={handleSignIn} disabled={isSignedIn}>
            {isSignedIn ? "âœ¨ å·²ç°½åˆ° âœ¨" : "ğŸŒ ç°½åˆ°"}
          </Button>
        </CardContent>
      </Card>
      <p className="text-sm text-gray-400 animate-fade">ç¶­è­·å®‡å®™çš„ç©©å®šï¼Œç”±ä½ é–‹å§‹ï¼ğŸš€</p>
    </div>
  );
}
